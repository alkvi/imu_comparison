---
title: "Comparison Opal and ActiGraph in MobGap pipeline"
bibliography: C:/pandoc/zotero_lib.bib
format: 
  html:
    code-fold: true
    code-summary: "Show the code"
    embed-resources: true
    toc: true
    toc-depth: 2
    toc-expand: 2
    theme: flatly
    output-file: index.html

editor: source
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=10, fig.height=5) 

```

# Repository

GitHub repository with all code and data:

<https://github.com/alkvi/imu_comparison>

# Presentation

[Slides](https://github.com/alkvi/imu_comparison/comparison_slides.html)

# Specifications

Simultaneous data was recorded from a lumbar APDM Opal sensor and a hip ActiGraph wGT3X-BT sensor.

Opal specifications (from APDM Developer's guide):

- 3-axis accelerometer
- 3-axis gyroscope
- 3-axis magnetometer
- 128 Hz sampling frequency
- accelerometer range is +-58.8 m/s^2
- The X and Y axis gyros have a range of +-34:9 rad/s (2000 dps)
- The Z axis gyro has a range of +-26:8 rad/s (1500 dps)
- Magnetometers have a range of +-6 Gauss

ActiGraph specifications (website):

- 3-axis accelerometer
- 30 Hz sampling frequency
- range +-8G

# Pipeline and possible orientation and aliasing concerns

We want to run the [Mobilise-D MobGap pipeline](https://github.com/mobilise-d/mobgap).

The original implementation uses a 100 Hz 3-axis IMU/MARG data (accelerometer, gyroscope, magnetometer). The Opal sensor satisfies these specifications, but the ActiGraph is obviously less powerful.

Most algorithms in the MobGap pipeline lowpass to frequencies below 10 Hz. Gait sequence detection also resample down to 40 Hz as a first step, without lowpassing first.

However, if we lowpass a 128 Hz signal and lowpass a 30 Hz signal we might get very different results. This depends on if there are frequency components in the data that are higher than the Nyqvist frequency of either system. With the Opal, we can comfortably filter out frequency components up to 64 Hz. For the Actigraph however, we are quite strongly limited to 15 Hz.

Therefore, we might have issues with aliasing of high-frequency gait components when using a low-passed ActiGraph signal.

Additionaly, an IMU/MARG system can make use of sensor fusion algorithms like the [Madgwick filter](https://doi.org/10.1109/ICORR.2011.5975346) to estimate orientation quaternions, in order to figure out how they are rotated in a global frame. This helps with estimating the effect of gravity when the sensor is in motion. This is not possible with only an accelerometer. There are some accelerometer-only methods that can give an estimate (for example in [Moe-Nilssen 1998](https://doi.org/10.1016/S0268-0033(98)00089-8)) but these will generally be much less accurate.

# Frequency components of gait

Are there frequency components in gait data above 15 Hz that would make our ActiGraph data unusable?

There are a couple of articles looking at this.

- [Frequency evaluation of gait trunk acceleration signal: A longitudinal study](https://doi.org/10.1016/j.gaitpost.2017.07.057) or [PDF](https://www.esb-ita.it/wp-content/uploads/2017/09/G16_Tamburini_ESBITA2017.pdf)

> Results highlighted that: the harmonic content (at 98%) of the acceleration signal for all the analysed population, with exception of the adolescents, is below 30 Hz where the high frequencies contribute is due to the AP direction.

- [The frequency content of gait](https://doi.org/10.1016/0021-9290(85)90043-0)

> In order to preserve 99% of the signal power in gait, positional fidelity must be maintained up to 15 Hz which for a sampled system requires a minimum of 30 Hz sampling rate.

- [Adaptive algorithm for gait segmentation using a single IMU in the thigh pocket](https://doi.org/10.1109/JSEN.2022.3177951)

> Since the amplitude spectra of gait signals is concentrated below 15 Hz [34]

- [34] is: [Frequency content of whole body gait kinematic data](https://doi.org/10.1109/86.296343)

- [A Systematic Method for Outlier Detection in Human Gait Data](https://doi.org/10.1109/ICORR55369.2022.9896411)

> This is based on the frequency components of gait data, which are usually much lower (1-3 Hz) compared to the usually high acquisition frequency (usually 100 Hz)

So perhaps we might still be OK!

# Comparison

Data was collected simultaneously for walking in a lab setting (back and forth 10 times across a 30 m corridor) and while walking outside. The lab walk was more consistent speed, while the outside was varied (pausing, much more turning, up and down in elevation, etc).

Synchronization was performed by standing still for 10 seconds, jumping 3 times, standing still for another 10 seconds, and then starting the walking bout. Data was then manually synchronized to the jumping point in [sync_imu_data.py](link).

Note that a cadence of 117 steps/min and stride length of 1.58 m is average for males (https://ouhsc.edu/bserdac/dthompso/web/gait/knmatics/stride.htm).

## Comparison 1 - single subject, detailed fragment, approx 20 seconds

See [comparison_1](comparison_1_detail.html)

We find an average cadence of 117.58 from the Opal data, and 116.73 from the ActiGraph data.

Average stride lengths: Opal 1.6 m, ActiGraph 1.57 m.

## Comparison 2 - single subject, lab data, approx 4 min

See [comparison_2](comparison_2_lab.html)

We find an average cadence of 118.57 from the Opal data, and 118.94 from the ActiGraph data.

Average stride lengths: Opal 1.51 m, ActiGraph 1.48 m.

## Comparison 3 - single subject, outside data, approx 12 min

See [comparison_3](comparison_3_outside.html)

We find an average cadence of 115.47 from the Opal data, and 115.88 from the ActiGraph data.

Average stride lengths: Opal 1.528 m, ActiGraph 1.521 m.

## Comparison 4 - multiple subjects, all sessions

See [comparison_4](comparison_4_multiple.html)

![](img/global_walk_speed_comparison.png)

