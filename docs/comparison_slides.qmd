---
title: "Comparison Opal and ActiGraph in MobGap pipeline"
bibliography: C:/pandoc/zotero_lib.bib
format: 
  revealjs:
    slide-level: 2
    slide-number: true
    progress: true
    controls: true
    mouse-wheel: false
    embed-resources: true


editor: source
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=10, fig.height=5) 

```


## Specifications {.smaller}

:::: {.columns}

::: {.column width="50%"}
Opal

- 3-axis accelerometer
- 3-axis gyroscope
- 3-axis magnetometer
- 128 Hz sampling frequency
- accelerometer range is +-58.8 m/s^2
- The X and Y axis gyros have a range of +-34:9 rad/s (2000 dps)
- The Z axis gyro has a range of +-26:8 rad/s (1500 dps)
- Magnetometers have a range of +-6 Gauss
:::

::: {.column width="50%"}
ActiGraph wGT3X-BT

- 3-axis accelerometer
- 30 Hz sampling frequency
- range +-8G
:::

::::

# Concerns {.smaller}

- Low sampling frequency
    - Aliasing of high frequency components

- Lack of gyroscope
    - Sensor fusion for orientation estimation cannot be used

## Low sampling rate {.smaller}

Sampling a high frequency component (red) at a low sampling rate will cause the high frequency component to look like a low frequency component (blue).

This could get mixed up with real low-frequency components.

Additionally, when we then low-pass the data, it might become distorted.

![](img/alias.png)

## Low sampling rate {.smaller}

This might not be such a large problem in gait data. 

There is a lot of power concentrated to below 15 Hz. 

See articles: 

<https://alkvi.github.io/imu_comparison/#frequency-components-of-gait>

## Orientation estimation {.smaller}

The MobGap implementation uses the [Madgwick filter](https://doi.org/10.1109/ICORR.2011.5975346) to estimate global frame orientation, to better estimate stride length and walking speed.

This requires a gyroscope (and preferably a magnetometer).

The ActiGraph does not have this.

However, to at least counteract variations in ActiGraph placement, the vertical axis could be aligned with gravity before each gait sequence, if we detect a stable period before the gait sequence. 

For example using something like [Moe-Nilssen 1998](https://doi.org/10.1016/S0268-0033(98)00089-8).

## Comparison {.smaller}

The same MobGap pipeline was run on both lumbar Opal and hip ActiGraph data.

- Gait sequence identification
- Intial contact detection
- Cadence estimation
- Stride length estimation
- Walking speed estimation

## Comparison - filtered data {.smaller}

Here is the same snippet of gait data from the Opal and ActiGraph bandpassed between 0.15 Hz and 3.14 Hz, as used in [initial contact detection](https://github.com/mobilise-d/mobgap/blob/main/src/mobgap/initial_contacts/_icd_ionescu.py).

There does not seem to be issues with high frequency components, at least during stable gait such as this example.

![](img/bandpassed_snippet.png)

## Comparison - gait sequence and initial contacts {.smaller}

This a comparison of detected gait sequences and initial contacts for an approximately 8 minute walk outside including variations in pace, turning, some stopping. There is a difference of 4 found initial contacts (772 vs 768).

![](img/ic_detection_outside_subj2.png)

## Comparison - stride length in lab {.smaller}

This comparison of stride length without orientation estimation (left) vs with orientation estimation (right) illustrates the effect a slight systematic error for the ActiGraph, but subject parameters can clearly be delineated.

::: {.column width="50%"}
![](img/lab_stride_length.png)
:::

::: {.column width="50%"}
![](img/lab_global_stride_length.png)
:::

## Comparison - stride length outside {.smaller}

![](img/global_stride_length_comparison.png)

## Comparison - walking speed outside {.smaller}

![](img/global_walk_speed_comparison.png)